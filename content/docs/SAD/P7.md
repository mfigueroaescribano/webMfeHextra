---
title: Virtual Private Networks
type: docs
---
Para la realización de esta práctica montaremos ambos escenarios en GNS3.
# OpenVPN
## VPN de acceso remoto con OpenVPN y certificados x509
Instalamos la appliance de debian12, y colocamos 3 en el escenario. 

- **Cliente:** interfaz `ens4` configurada con la IP 192.168.0.20/24, que conecta con `ens4` de `servidor` 

- **Servidor:** cuenta con dos interfaces. `ens4` que conecta con `cliente` con la IP 192.168.0.10/24, y `ens5` que conecta con `maquina` con la IP 192.168.1.10.

- **Maquina:** interfaz `ens4` configurada con la IP 192.168.1.30/24.

Levantamos la interfaces y comprobamos que ambas máquinas hacen ping al `servidor`. Ahora, en el `servidor`, activamos el bit de forwarding editando el fichero `/etc/sysctl.conf` descomentado la línea:
```
net.ipv4.ip_forward=1
```
Hacemos lo cambios efectivos con el comando:
`sysctl -p`

Procedemos ahora a instalar OpenVPN en la máquina `servidor`, con `apt install openvpn`. Tendremos que conectar esta máquina previamente a un nodo NAT de GNS3.

Copiamos ahora los ficheros del directorio `/usr/share/easy-rsa/` al directprop `/etc/openvpn/` con los comandos:
```
cp -r /usr/share/easy-rsa /etc/openvpn
```

Ejecutamos ahora el script de infraestructura de clave pública (PKI) para que genere los certificados:
```
cd /etc/openvpn/easy-rsa
sudo ./easyrsa init-pki
```
![Alt text](/images/p7-1.png)

Con el comando `./easyrsa build-ca` generamos la clave privada, y se guardará en el directorio `/etc/openvpn/easy-rsa/pki/`.

Hemos introducido los siguientes parámetros:
```
CA Key Passphrase: iesgn
PEM pass phrase: iesgn
Common Name: miguel
```

Generaremos ahora el certificado del servidor, y los certificados Diffie-Helman:
```
./easyrsa build-server-full server nopass
./easyrsa gen-dh
```
Y ahora generaremos el certificado y la clave para la máquina cliente:

```
./easyrsa build-client-full cliente nopass
```
- La clave se encuentra en el directorio `/etc/openvpn/easy-rsa/pki/private/cliente.key`

- El certificado lo encontramos en `/etc/openvpn/easy-rsa/pki/issued/cliente.crt`.

Ahora debemos copiar los archivos `ca.crt`, `cliente.crt` y `cliente.key` a la máquina cliente. Copiamos en primer lugar estos archivos a la carpeta `/home/archivoscliente`:
```
cp /etc/openvpn/easy-rsa/pki/ca.crt /home/debian/archivoscliente/
cp /etc/openvpn/easy-rsa/pki/issued/cliente.crt /home/debian/archivoscliente/
cp /etc/openvpn/easy-rsa/pki/private/cliente.key /home/debian/archivoscliente/
```
Cambiamos los permisos de estos tres archivos a `debian`:
```
sudo chown debian: *
```

Y los copiamos a la máquina `cliente`:
```
scp * debian@192.168.0.20:/home/debian
```

Con los ficheros de configuración de clientes ya copiado en la primera máquina `cliente`, terminaremos de configurar el servidor con la configuración de OpenVPN. Para ello usaremos la plantilla `/usr/share/doc/openvpn/examples/sample-config-files/server.conf` y lo copiamos a `/etc/openvpn/server/server.conf`:

```
port 1194
proto udp
dev tun

ca /etc/openvpn/easy-rsa/pki/ca.crt
cert /etc/openvpn/easy-rsa/pki/issued/server.crt
key /etc/openvpn/easy-rsa/pki/private/server.key
dh /etc/openvpn/easy-rsa/pki/dh.pem

topology subnet

server 10.99.99.0 255.255.255.0
ifconfig-pool-persist /var/log/openvpn/ipp.txt

push "route 192.168.1.0 255.255.255.0"

keepalive 10 120
cipher AES-256-CBC
persist-key
persist-tun
status /var/log/openvpn/openvpn-status.log
verb 3
explicit-exit-notify 1
```
Activamos el servicio de OpenVPN y lo arrancamos:
```
systemctl enable --now openvpn-server@server
sudo systemctl status openvpn-server@server
```
![Alt text](/images/p7-2.png)



## VPN sitio a sitio con OpenVPN y certificados x509

# WireGuard
## VPN de acceso remoto con WireGuard
## VPN sitio a sitio con WireGuard